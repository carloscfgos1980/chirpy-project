# Create a route to update the user data

1. <sql/queries/users.sql> New querie to update the user:

-- name: UpdateUser :one
UPDATE users SET email = $2, hashed_password = $3, updated_at = NOW()
WHERE id = $1
RETURNING *;


2. From server as root. run the generate command from the terminal:
sqlc generate

3. Create a function that process the token coming in the request header and the new email and password to update the user
<handler_users_update.go>. 

func (cfg *apiConfig) handlerUsersUpdate(w http.ResponseWriter, r*http.Request) {

3.1 create a truct for the request data:

 type parameters struct {
  Password string `json:"password"`
  Email    string `json:"email"`
 }

 3.2 Create a struc for the response (updated user):

 type response struct {
  User
 }

3.3 Get the token:

 token, err := auth.GetBearerToken(r.Header)
 if err != nil {
  respondWithError(w, http.StatusUnauthorized, "Couldn't find JWT", err)
  return
 }

 3.4 get userId from validateJWT function:

 userID, err := auth.ValidateJWT(token, cfg.jwtSecret)
 if err != nil {
  respondWithError(w, http.StatusUnauthorized, "Couldn't validate JWT", err)
  return
 }

3.5 create a variable for the request's data and populate it:

 decoder := json.NewDecoder(r.Body)
 params := parameters{}
 err = decoder.Decode(&params)
 if err != nil {
  respondWithError(w, http.StatusInternalServerError, "Couldn't decode parameters", err)
  return
 }

3.6 Hash password:

 hashedPassword, err := auth.HashPassword(params.Password)
 if err != nil {
  respondWithError(w, http.StatusInternalServerError, "Couldn't hash password", err)
  return
 }

3.7 Update the user in the database. This has 3 parameters. First userId in order to find the user that need to be updated:

 user, err := cfg.db.UpdateUser(r.Context(), database.UpdateUserParams{
  ID:             userID,
  Email:          params.Email,
  HashedPassword: hashedPassword,
 })
 if err != nil {
  respondWithError(w, http.StatusInternalServerError, "Couldn't update user", err)
  return
 }

 3.8 Response with the updated user in database

 respondWithJSON(w, http.StatusOK, response{
  User: User{
   ID:        user.ID,
   CreatedAt: user.CreatedAt,
   UpdatedAt: user.UpdatedAt,
   Email:     user.Email,
  },
 })
}
